FROM python:3.11

WORKDIR /

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    curl \
    wget \
    zip \
    tree \
    unzip && \
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y --no-install-recommends nodejs && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

RUN node --version && npm --version

# Create React app with Vite
RUN npm create vite@latest frontend -- --template react

# Set working directory and install dependencies
WORKDIR /frontend
COPY ../sample-package-react-shadcn-vite.json /frontend/package.json
RUN npm install

# Install additional dependencies
RUN npm install lucide-react axios recharts @radix-ui/react-icons tailwind-merge react-hook-form
RUN npm install -D eslint eslint-plugin-react

# Install and set up Tailwind CSS manually
RUN npm install -D tailwindcss postcss autoprefixer

# Create Tailwind config files with .cjs extension for CommonJS syntax
RUN echo 'module.exports = {\n\
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],\n\
  theme: {\n\
    extend: {},\n\
  },\n\
  plugins: [],\n\
};' > tailwind.config.cjs

RUN echo 'module.exports = {\n\
  plugins: {\n\
    tailwindcss: {},\n\
    autoprefixer: {},\n\
  }\n\
}' > postcss.config.cjs

# Add CSS imports for tailwind
RUN echo '@tailwind base;\n\
@tailwind components;\n\
@tailwind utilities;' > ./src/index.css

# Try to set up shadcn (may not work, but won't fail the build)
RUN npm install -D @shadcn/ui || true
RUN mkdir -p /frontend/components/ui

# Update Vite config using ES module syntax
RUN echo 'import { defineConfig } from "vite";\n\
import react from "@vitejs/plugin-react";\n\
\n\
export default defineConfig({\n\
  plugins: [react()],\n\
  server: {\n\
    port: 3000,\n\
    host: "0.0.0.0"\n\
  }\n\
});' > vite.config.js

EXPOSE 3000
